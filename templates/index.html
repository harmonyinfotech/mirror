<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magic Mirror - Instant Text Sharing</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Share text magically between devices on your network. No signup, no installation - just open and share.">
    <meta name="keywords" content="magic mirror, text sharing, file sharing, local network, instant sync, clipboard sharing">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://mirror.is/">
    <meta property="og:title" content="Magic Mirror - Instant Text Sharing">
    <meta property="og:description" content="Share text magically between devices on your network. No signup, no installation - just open and share.">
    <meta property="og:image" content="https://mirror.is/static/og-image.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://mirror.is/">
    <meta property="twitter:title" content="Magic Mirror - Instant Text Sharing">
    <meta property="twitter:description" content="Share text magically between devices on your network. No signup, no installation - just open and share.">
    <meta property="twitter:image" content="https://mirror.is/static/og-image.png">
    
    <!-- Favicon -->
    <link rel="apple-touch-icon" sizes="180x180" href="/static/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/favicon-16x16.png">
    <link rel="manifest" href="/static/site.webmanifest">
    <link rel="mask-icon" href="/static/safari-pinned-tab.svg" color="#4299E1">
    <meta name="msapplication-TileColor" content="#4299E1">
    <meta name="theme-color" content="#4299E1">
    
    <style>
        :root {
            --primary-color: #2D3748;
            --secondary-color: #4A5568;
            --accent-color: #4299E1;
            --background-color: #F7FAFC;
            --text-color: #1A202C;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
        }
        
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .logo {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-decoration: none;
            letter-spacing: -1px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .logo-icon {
            font-size: 2rem;
        }
        
        .tagline {
            font-size: 1.1rem;
            color: var(--secondary-color);
            margin: 0.5rem 0;
            text-align: center;
            font-style: italic;
        }
        
        .stats {
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .stats span {
            margin-right: 1rem;
        }
        
        .main-container {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 2rem;
        }
        
        .content-area {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .ad-sidebar {
            align-self: start;
            position: sticky;
            top: 20px;
        }
        
        .ad-container {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            min-height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        textarea {
            width: 100%;
            height: 300px;
            margin: 10px 0;
            padding: 15px;
            border: 1px solid #E2E8F0;
            border-radius: 6px;
            resize: vertical;
            font-size: 16px;
            line-height: 1.5;
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 6px;
            display: none;
        }
        
        .success { background-color: #dff0d8; color: #3c763d; }
        .error { background-color: #f2dede; color: #a94442; }
        
        .info {
            font-size: 0.9rem;
            color: var(--secondary-color);
            margin-top: 10px;
        }
        
        .disclaimer {
            margin-top: 20px;
            padding: 15px;
            background-color: #fff3cd;
            border: 1px solid #ffeeba;
            border-radius: 6px;
            color: #856404;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.9rem;
            color: var(--secondary-color);
        }
        
        .footer a {
            color: var(--accent-color);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .button-group {
            display: flex;
            gap: 0.5rem;
            margin: 1rem 0;
        }
        
        .action-button {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 4px;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        
        .action-button:hover {
            background: #357ABD;
        }
        
        .action-button:active {
            background: #2563EB;
        }
        
        .action-button.secondary {
            background: var(--secondary-color);
        }
        
        .action-button.secondary:hover {
            background: #64748B;
        }
        
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            background: var(--primary-color);
            color: white;
            font-size: 0.9rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        
        .toast.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .main-container {
                grid-template-columns: 1fr;
            }
            
            .ad-sidebar {
                position: static;
                margin-top: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <a href="/" class="logo">
            <span class="logo-icon">‚ú®</span>
            Magic Mirror
        </a>
        <p class="tagline">Share text magically between devices</p>
        <div class="stats">
            <span title="Today's Pageviews">üëÅÔ∏è {{ stats.today_pageviews }}</span>
            <span title="Today's Unique Visitors">üë§ {{ stats.today_unique_visitors }}</span>
            <span title="Today's Syncs">üîÑ {{ stats.today_syncs }}</span>
            <span title="Characters Shared Today">üìù {{ '{:,}'.format(stats.today_chars) }}</span>
        </div>
    </div>

    <div class="main-container">
        <div class="content-area">
            <div class="button-group">
                <button class="action-button" onclick="pasteFromClipboard()" title="Paste from clipboard">
                    üìã Paste
                </button>
                <button class="action-button" onclick="copyToClipboard()" title="Copy to clipboard">
                    üìù Copy
                </button>
                <button class="action-button secondary" onclick="clearContent()" title="Clear content">
                    üóëÔ∏è Clear
                </button>
            </div>
            <textarea id="content" placeholder="Type or paste your content here... It will automatically sync with other devices on your network"></textarea>
            
            <div class="info">Content automatically syncs every 2 seconds</div>
            <div id="status" class="status"></div>
            
            <div class="disclaimer">
                ‚ö†Ô∏è Security Notice: This is a simple text sharing tool for convenience. Please do not share sensitive information 
                like passwords, secret keys, or personal data. Content is stored temporarily and shared with anyone on the same network.
            </div>
        </div>
        
        <div class="ad-sidebar">
            <div class="ad-container">
                <script>
                    var cpmstar_rnd = Math.round(Math.random()*999999);
                    var cpmstar_pid = 35452;
                    var cpmstar_subpid = 0;
                    document.writeln("<SCR"+"IPT language='Javascript' src='//server.cpmstar.com/view.aspx?poolid="+cpmstar_pid+"&script=1&rnd="+cpmstar_rnd+"&subpoolid="+cpmstar_subpid+"'></SCR"+"IPT>");
                </script>
            </div>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <footer class="footer">
        <p>
            <a href="https://github.com/harmonyinfotech/mirror" target="_blank">GitHub</a> ‚Ä¢ 
            <a href="/about">About</a>
        </p>
        <p> 2024 Magic Mirror v{{ version }} - Share text magically</p>
    </footer>

    <script>
        let lastContent = '';
        let currentVersion = 0;
        let typingTimer;
        const doneTypingInterval = 500;
        let isTyping = false;
        
        const textarea = document.getElementById('content');
        const STORAGE_KEY = 'mirror_content';
        
        // Load content from localStorage on page load
        function loadStoredContent() {
            try {
                const stored = localStorage.getItem(STORAGE_KEY);
                if (stored) {
                    const data = JSON.parse(stored);
                    if (data && data.content && data.version) {
                        textarea.value = data.content;
                        lastContent = data.content;
                        currentVersion = data.version;
                        return true;
                    }
                }
            } catch (error) {
                console.error('Error loading stored content:', error);
            }
            return false;
        }
        
        // Save content to localStorage
        function saveToStorage(content, version) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify({
                    content,
                    version,
                    timestamp: Date.now()
                }));
            } catch (error) {
                console.error('Error saving to storage:', error);
            }
        }
        
        async function saveContent() {
            const content = textarea.value;
            if (content === lastContent) return;
            
            lastContent = content;
            try {
                const response = await fetch('/api/content', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        content,
                        version: currentVersion
                    }),
                });
                
                const data = await response.json();
                if (data.status === 'success') {
                    currentVersion = data.version;
                    saveToStorage(data.content, data.version);
                } else if (data.status === 'outdated') {
                    // Our version is behind, update the content
                    if (!isTyping) {
                        textarea.value = data.content;
                        lastContent = data.content;
                        currentVersion = data.version;
                        saveToStorage(data.content, data.version);
                    }
                }
            } catch (error) {
                showStatus('Error saving content: ' + error.message, 'error');
            }
        }

        async function refreshContent() {
            if (isTyping) return; // Don't refresh while user is typing
            
            try {
                const response = await fetch(`/api/content?version=${currentVersion}`);
                const data = await response.json();
                
                if (data.has_update && !isTyping) {
                    textarea.value = data.content;
                    lastContent = data.content;
                    currentVersion = data.version;
                    saveToStorage(data.content, data.version);
                }
            } catch (error) {
                showStatus('Error refreshing content: ' + error.message, 'error');
            }
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = 'status ' + type;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 3000);
        }

        function showToast(message, duration = 2000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }
        
        async function copyToClipboard() {
            const content = textarea.value;
            try {
                await navigator.clipboard.writeText(content);
                showToast('Copied to clipboard! üìã');
            } catch (err) {
                showToast('Failed to copy: ' + err.message);
            }
        }
        
        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                textarea.value = text;
                lastContent = text;
                saveContent();
                showToast('Pasted from clipboard! üìù');
            } catch (err) {
                showToast('Failed to paste: ' + err.message);
            }
        }
        
        function clearContent() {
            if (confirm('Are you sure you want to clear the content?')) {
                textarea.value = '';
                lastContent = '';
                saveContent();
                showToast('Content cleared! üóëÔ∏è');
            }
        }
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Check if Ctrl/Cmd key is pressed
            if ((e.ctrlKey || e.metaKey) && !e.shiftKey && !e.altKey) {
                switch(e.key.toLowerCase()) {
                    case 'v':
                        e.preventDefault();
                        pasteFromClipboard();
                        break;
                    case 'c':
                        e.preventDefault();
                        copyToClipboard();
                        break;
                }
            }
        });
        
        // Handle paste event
        textarea.addEventListener('paste', (e) => {
            // The input event will handle the content update
            showToast('Content pasted! üìã');
        });
        
        // Add drag and drop support
        textarea.addEventListener('dragover', (e) => {
            e.preventDefault();
            textarea.classList.add('dragover');
        });
        
        textarea.addEventListener('dragleave', () => {
            textarea.classList.remove('dragover');
        });
        
        textarea.addEventListener('drop', (e) => {
            e.preventDefault();
            textarea.classList.remove('dragover');
            
            if (e.dataTransfer.items) {
                for (let item of e.dataTransfer.items) {
                    if (item.kind === 'string' && item.type === 'text/plain') {
                        item.getAsString((text) => {
                            textarea.value = text;
                            lastContent = text;
                            saveContent();
                            showToast('Content dropped! üìÑ');
                        });
                        break;
                    }
                }
            }
        });
        
        textarea.addEventListener('input', () => {
            isTyping = true;
            clearTimeout(typingTimer);
            typingTimer = setTimeout(() => {
                isTyping = false;
                saveContent();
            }, doneTypingInterval);
        });

        // Load stored content first, then refresh from server
        if (!loadStoredContent()) {
            refreshContent();
        }
        
        // Refresh every 2 seconds if not typing
        setInterval(refreshContent, 2000);
    </script>
</body>
</html>
